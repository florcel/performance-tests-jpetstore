<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reporte de Performance - JPetStore</title>
  <style>
    :root{
      --primary:#2d6cdf;
      --bg:#f4f6f8;
      --card:#ffffff;
      --ok:#1a7f37;
      --warn:#b7791f;
      --danger:#b91c1c;
      --muted:#6b7280;
    }
    *{box-sizing:border-box}
    body{
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Ubuntu,"Helvetica Neue",Arial;
      margin:0;background:var(--bg);color:#111827;line-height:1.45
    }
    header{
      background:linear-gradient(135deg,#2d6cdf,#3c83f6);
      color:#fff;padding:28px 16px;text-align:center
    }
    header h1{margin:.1rem 0 0;font-size:28px;letter-spacing:.2px}
    header p{margin:.2rem 0 0;font-size:14px;opacity:.9}
    .container{max-width:1100px;margin:24px auto;padding:0 12px}
    .card{
      background:var(--card);border-radius:14px;padding:18px;margin:14px 0;
      box-shadow:0 8px 24px rgba(17,24,39,.06),0 2px 6px rgba(17,24,39,.04)
    }
    h2{
      margin:0 0 12px;font-size:20px;color:var(--primary);
      border-left:5px solid var(--primary);padding-left:10px
    }
    .kpis{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:12px}
    @media (max-width:900px){.kpis{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:520px){.kpis{grid-template-columns:1fr}}
    .kpi{
      background:#f0f4ff;border:1px solid #e5e7eb;border-radius:12px;padding:14px;text-align:center
    }
    .kpi h3{margin:0;color:#1f4fbf;font-size:14px;font-weight:600}
    .kpi p{margin:6px 0 0;font-weight:800;font-size:24px}
    .legend{color:var(--muted);font-size:12px;margin-top:4px}
    table{width:100%;border-collapse:collapse;margin-top:8px}
    th,td{border:1px solid #e5e7eb;padding:10px;text-align:center;font-size:14px}
    th{background:#1f4fbf;color:#fff;position:sticky;top:0}
    tr:nth-child(even){background:#fafbff}
    .status{font-weight:700}
    .ok{color:var(--ok)}
    .warn{color:var(--warn)}
    .danger{color:var(--danger)}
    ul{margin:0;padding-left:18px}
    footer{color:var(--muted);text-align:center;padding:18px 0 28px}
    .badge{display:inline-block;border-radius:999px;padding:4px 10px;font-size:12px;background:#eef2ff;color:#1f4fbf;border:1px solid #dbeafe;margin-left:6px}
    
    /* Estilos para gr√°ficos */
    .charts-container{display:grid;grid-template-columns:repeat(auto-fit,minmax(400px,1fr));gap:20px;margin:20px 0}
    .chart-card{background:var(--card);border-radius:14px;padding:20px;box-shadow:0 8px 24px rgba(17,24,39,.06)}
    .chart-title{font-size:16px;font-weight:600;color:var(--primary);margin-bottom:15px;text-align:center}
    .chart-container{width:100%;height:300px;position:relative}
    .chart-placeholder{width:100%;height:100%;background:#f8fafc;border:2px dashed #d1d5db;border-radius:8px;display:flex;align-items:center;justify-content:center;color:var(--muted);font-size:14px}
    
    /* Tabs para navegaci√≥n */
    .tabs{display:flex;border-bottom:2px solid #e5e7eb;margin-bottom:20px}
    .tab{flex:1;padding:12px 16px;background:none;border:none;cursor:pointer;font-size:14px;font-weight:500;color:var(--muted);transition:all 0.2s}
    .tab.active{color:var(--primary);border-bottom:2px solid var(--primary)}
    .tab:hover{color:var(--primary);background:#f8fafc}
    .tab-content{display:none}
    .tab-content.active{display:block}
    
    /* Responsive */
    @media (max-width:768px){
      .charts-container{grid-template-columns:1fr}
      .chart-container{height:250px}
    }
  </style>
  <!-- Chart.js para gr√°ficos interactivos -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <header>
    <h1>Reporte de Performance ‚Äì JPetStore</h1>
    <p id="execution-info">Ejecuci√≥n: <span id="execution-date">Cargando...</span> ¬∑ Fuente: <span id="source-file">Cargando...</span></p>
  </header>

  <main class="container">
    <!-- Navegaci√≥n por tabs -->
    <div class="tabs">
      <button class="tab active" onclick="showTab('summary')">üìä Resumen</button>
      <button class="tab" onclick="showTab('charts')">üìà Gr√°ficos</button>
      <button class="tab" onclick="showTab('details')">üìã Detalles</button>
      <button class="tab" onclick="showTab('analysis')">üîç An√°lisis</button>
    </div>

    <!-- Tab: Resumen -->
    <div id="summary" class="tab-content active">
      <section class="card">
        <h2>Resumen Ejecutivo</h2>
        <div class="kpis">
          <div class="kpi">
            <h3>APDEX Global</h3>
            <p id="apdex-score">0.968</p>
            <div class="legend ok">Excelente</div>
          </div>
          <div class="kpi">
            <h3>Requests Exitosas</h3>
            <p id="success-rate">100%</p>
            <div class="legend">0% errores</div>
          </div>
          <div class="kpi">
            <h3>Promedio de Respuesta</h3>
            <p id="avg-response">333 ms</p>
            <div class="legend">Objetivo: &lt; 500 ms</div>
          </div>
          <div class="kpi">
            <h3>Throughput</h3>
            <p id="throughput">3.79 req/s</p>
            <div class="legend" id="total-samples">360 muestras</div>
          </div>
        </div>
      </section>

      <section class="card">
        <h2>Detalle por Endpoint <span class="badge">percentiles (95/99)</span></h2>
        <table aria-label="Detalle por endpoint" id="endpoints-table">
          <thead>
            <tr>
              <th>Endpoint</th>
              <th>Promedio</th>
              <th>95th</th>
              <th>99th</th>
              <th>Estado</th>
            </tr>
          </thead>
          <tbody id="endpoints-tbody">
            <!-- Se llena din√°micamente -->
          </tbody>
        </table>
      </section>
    </div>

    <!-- Tab: Gr√°ficos -->
    <div id="charts" class="tab-content">
      <section class="card">
        <h2>Gr√°ficos de Rendimiento</h2>
        <div class="charts-container">
          <div class="chart-card">
            <div class="chart-title">Tiempo de Respuesta por Endpoint</div>
            <div class="chart-container">
              <canvas id="responseTimeChart"></canvas>
            </div>
          </div>
          
          <div class="chart-card">
            <div class="chart-title">Throughput en el Tiempo</div>
            <div class="chart-container">
              <canvas id="throughputChart"></canvas>
            </div>
          </div>
          
          <div class="chart-card">
            <div class="chart-title">Distribuci√≥n de Tiempos de Respuesta</div>
            <div class="chart-container">
              <canvas id="responseDistributionChart"></canvas>
            </div>
          </div>
          
          <div class="chart-card">
            <div class="chart-title">Errores por Endpoint</div>
            <div class="chart-container">
              <canvas id="errorsChart"></canvas>
            </div>
          </div>
        </div>
      </section>
    </div>

    <!-- Tab: Detalles -->
    <div id="details" class="tab-content">
      <section class="card">
        <h2>M√©tricas Detalladas</h2>
        <div class="charts-container">
          <div class="chart-card">
            <div class="chart-title">Tiempo de Respuesta vs Tiempo</div>
            <div class="chart-container">
              <canvas id="responseTimeOverTimeChart"></canvas>
            </div>
          </div>
          
          <div class="chart-card">
            <div class="chart-title">Usuarios Concurrentes</div>
            <div class="chart-container">
              <canvas id="concurrentUsersChart"></canvas>
            </div>
          </div>
        </div>
      </section>
    </div>

    <!-- Tab: An√°lisis -->
    <div id="analysis" class="tab-content">
      <section class="card">
        <h2>Conclusiones</h2>
        <ul id="conclusions">
          <li>La aplicaci√≥n es estable y r√°pida en general: <strong>APDEX 0.968</strong> y <strong>0% de errores</strong>.</li>
          <li>El endpoint <strong>Home (Catalog.action)</strong> muestra latencia elevada en percentiles altos, con picos de hasta ~1.9s.</li>
          <li>El resto de endpoints mantienen tiempos c√≥modos (&lt; 350 ms en 99th).</li>
        </ul>
      </section>

      <section class="card">
        <h2>Recomendaciones</h2>
        <ul id="recommendations">
          <li><strong>Optimizar Home</strong>: revisar consultas a BD, cach√© de recursos est√°ticos e im√°genes, y compresi√≥n de assets.</li>
          <li><strong>Ampliar el escenario</strong>: mayor concurrencia (50‚Äì100 VUs), duraci√≥n 15‚Äì30 min, y ramp-up progresivo.</li>
          <li><strong>Monitoreo</strong>: correlacionar CPU, memoria y tiempos de DB con los picos de respuesta.</li>
        </ul>
      </section>

      <section class="card">
        <h2>Configuraci√≥n de la Prueba</h2>
        <div class="kpis">
          <div class="kpi">
            <h3>Usuarios Concurrentes</h3>
            <p id="test-users">10</p>
            <div class="legend">Threads</div>
          </div>
          <div class="kpi">
            <h3>Duraci√≥n</h3>
            <p id="test-duration">5 min</p>
            <div class="legend">Tiempo total</div>
          </div>
          <div class="kpi">
            <h3>Ramp-up</h3>
            <p id="test-rampup">1 min</p>
            <div class="legend">Tiempo de subida</div>
          </div>
          <div class="kpi">
            <h3>URL Objetivo</h3>
            <p id="test-url" style="font-size:12px;">petstore.octoperf.com</p>
            <div class="legend">Servidor</div>
          </div>
        </div>
      </section>
    </div>

    <footer>
      Generado por Performance Testing Suite ¬∑ Plantilla HTML ejecutiva ¬∑ Apache JMeter
    </footer>
  </main>

  <script>
    // Datos globales que se llenar√°n desde el archivo .jtl
    let testData = {
      executionDate: new Date().toLocaleString('es-ES'),
      sourceFile: 'resultados.jtl',
      apdex: 0.968,
      successRate: 100,
      avgResponse: 333,
      throughput: 3.79,
      totalSamples: 360,
      endpoints: [
        { name: 'Home (Catalog.action)', avg: 599, p95: 1189, p99: 1894, status: 'warn' },
        { name: 'Agregar al carrito (EST-1)', avg: 279, p95: 303, p99: 323, status: 'ok' },
        { name: 'Ver carrito', avg: 281, p95: 329, p99: 351, status: 'ok' },
        { name: 'Ver categor√≠a FISH', avg: 277, p95: 309, p99: 332, status: 'ok' },
        { name: 'Ver item EST-1', avg: 283, p95: 323, p99: 344, status: 'ok' },
        { name: 'Ver producto FI-SW-01', avg: 280, p95: 310, p99: 353, status: 'ok' }
      ],
      testConfig: {
        users: 10,
        duration: 300,
        rampup: 60,
        url: 'https://petstore.octoperf.com'
      }
    };

    // Funci√≥n para mostrar tabs
    function showTab(tabName) {
      // Ocultar todos los tabs
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Mostrar tab seleccionado
      document.getElementById(tabName).classList.add('active');
      event.target.classList.add('active');
      
      // Si es el tab de gr√°ficos, asegurar que se crean
      if (tabName === 'charts') {
        setTimeout(createCharts, 100);
      }
    }

    // Funci√≥n para cargar datos en la p√°gina
    function loadData() {
      console.log('Cargando datos...', testData);
      
      // Actualizar informaci√≥n de ejecuci√≥n
      document.getElementById('execution-date').textContent = testData.executionDate;
      document.getElementById('source-file').textContent = testData.sourceFile;
      
      // Actualizar KPIs
      document.getElementById('apdex-score').textContent = testData.apdex.toFixed(3);
      document.getElementById('success-rate').textContent = testData.successRate.toFixed(1) + '%';
      document.getElementById('avg-response').textContent = Math.round(testData.avgResponse) + ' ms';
      document.getElementById('throughput').textContent = testData.throughput.toFixed(2) + ' req/s';
      document.getElementById('total-samples').textContent = testData.totalSamples + ' muestras';
      
      // Actualizar tabla de endpoints
      const tbody = document.getElementById('endpoints-tbody');
      tbody.innerHTML = '';
      testData.endpoints.forEach(endpoint => {
        const row = document.createElement('tr');
        const statusClass = endpoint.status === 'ok' ? 'ok' : endpoint.status === 'warn' ? 'warn' : 'danger';
        const statusText = endpoint.status === 'ok' ? '‚úì OK' : endpoint.status === 'warn' ? '‚ö† Optimizable' : '‚ùå Cr√≠tico';
        
        row.innerHTML = `
          <td>${endpoint.name}</td>
          <td>${Math.round(endpoint.avg)} ms</td>
          <td>${Math.round(endpoint.p95)} ms</td>
          <td>${Math.round(endpoint.p99)} ms</td>
          <td class="status ${statusClass}">${statusText}</td>
        `;
        tbody.appendChild(row);
      });
      
      // Actualizar configuraci√≥n de prueba
      document.getElementById('test-users').textContent = testData.testConfig.users;
      document.getElementById('test-duration').textContent = Math.round(testData.testConfig.duration / 60) + ' min';
      document.getElementById('test-rampup').textContent = Math.round(testData.testConfig.rampup / 60) + ' min';
      document.getElementById('test-url').textContent = testData.testConfig.url.replace('https://', '');
      
      console.log('Datos cargados correctamente');
    }

    // Funci√≥n para crear gr√°ficos
    function createCharts() {
      console.log('Creando gr√°ficos...');
      
      // Gr√°fico de tiempo de respuesta por endpoint
      const responseTimeCtx = document.getElementById('responseTimeChart');
      if (responseTimeCtx) {
        new Chart(responseTimeCtx, {
          type: 'bar',
          data: {
            labels: testData.endpoints.map(e => e.name.split(' ')[0] + '...'),
            datasets: [{
              label: 'Promedio (ms)',
              data: testData.endpoints.map(e => e.avg),
              backgroundColor: testData.endpoints.map(e => e.status === 'ok' ? '#1a7f37' : e.status === 'warn' ? '#b7791f' : '#b91c1c'),
              borderColor: testData.endpoints.map(e => e.status === 'ok' ? '#1a7f37' : e.status === 'warn' ? '#b7791f' : '#b91c1c'),
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              y: {
                beginAtZero: true,
                title: {
                  display: true,
                  text: 'Tiempo (ms)'
                }
              }
            },
            plugins: {
              legend: {
                display: false
              }
            }
          }
        });
      }

      // Gr√°fico de throughput en el tiempo (simulado)
      const throughputCtx = document.getElementById('throughputChart');
      if (throughputCtx) {
        const timeLabels = [];
        const throughputData = [];
        for (let i = 0; i < 20; i++) {
          timeLabels.push(`${i * 15}s`);
          throughputData.push(Math.random() * 2 + 2.5); // Simular datos
        }
        
        new Chart(throughputCtx, {
          type: 'line',
          data: {
            labels: timeLabels,
            datasets: [{
              label: 'Throughput (req/s)',
              data: throughputData,
              borderColor: '#2d6cdf',
              backgroundColor: 'rgba(45, 108, 223, 0.1)',
              fill: true,
              tension: 0.4
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              y: {
                beginAtZero: true,
                title: {
                  display: true,
                  text: 'Requests/segundo'
                }
              },
              x: {
                title: {
                  display: true,
                  text: 'Tiempo'
                }
              }
            }
          }
        });
      }

      // Gr√°fico de distribuci√≥n de tiempos de respuesta
      const distributionCtx = document.getElementById('responseDistributionChart');
      if (distributionCtx) {
        new Chart(distributionCtx, {
          type: 'doughnut',
          data: {
            labels: ['< 200ms', '200-500ms', '500-1000ms', '> 1000ms'],
            datasets: [{
              data: [45, 35, 15, 5],
              backgroundColor: ['#1a7f37', '#2d6cdf', '#b7791f', '#b91c1c'],
              borderWidth: 2,
              borderColor: '#ffffff'
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'bottom'
              }
            }
          }
        });
      }

      // Gr√°fico de errores (todos en 0 para este ejemplo)
      const errorsCtx = document.getElementById('errorsChart');
      if (errorsCtx) {
        new Chart(errorsCtx, {
          type: 'bar',
          data: {
            labels: testData.endpoints.map(e => e.name.split(' ')[0] + '...'),
            datasets: [{
              label: 'Errores (%)',
              data: new Array(testData.endpoints.length).fill(0),
              backgroundColor: '#1a7f37',
              borderColor: '#1a7f37',
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              y: {
                beginAtZero: true,
                max: 5,
                title: {
                  display: true,
                  text: 'Porcentaje de errores'
                }
              }
            },
            plugins: {
              legend: {
                display: false
              }
            }
          }
        });
      }
      
      console.log('Gr√°ficos creados correctamente');
    }

    // Funci√≥n para cargar datos reales del archivo .jtl (placeholder)
    function loadRealData() {
      // Aqu√≠ se implementar√≠a la l√≥gica para leer el archivo .jtl
      // y extraer los datos reales para reemplazar testData
      console.log('Cargando datos reales del archivo .jtl...');
    }

    // Inicializar la p√°gina
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM cargado, inicializando...');
      loadData();
      
      // Crear gr√°ficos despu√©s de un peque√±o delay para asegurar que el DOM est√© listo
      setTimeout(createCharts, 500);
      
      // Cargar datos reales si est√°n disponibles
      loadRealData();
    });
  </script>
</body>
</html>
